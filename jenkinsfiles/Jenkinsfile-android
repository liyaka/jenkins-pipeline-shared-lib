@Library('lulu-jenkins-pipeline-libs')
import lulu.jenkins.utils.*
import lulu.jenkins.ci.*

/*
This job parameters:
   for master job:
     - BUILD_TARGET_TYPE - Choice param: Debug/Release
   for branch job:
     - BRANCH_NAME - Git parameter with branch filter "^(?!origin/master$).*"
     - BUILD_TARGET_TYPE - Choice param: Debug/Release
   for release job:
     - RELEASE_BUILD_NUMBER - will be passed from parent release job
     - BRANCH_NAME - Git parameter with branch filter "^(?!origin/master$).*"
     - BUILD_TARGET_TYPE - Choice param: Debug/Release
*/

node ("master") {

    def pipeline = new AndroidPipeline(this)
    pipeline.projectName = "myorg/myandroidproject"
    if ( "${env.BRANCH_NAME}" == "" || "${env.BRANCH_NAME}" == "null" || "${env.BRANCH_NAME}" == "master" || "${env.BRANCH_NAME}" == "origin/master"){
      pipeline.setBranchProperties("master")
    } else {
      pipeline.setBranchProperties("branch")
    }

    pipeline.buildTarget = "assemble${env.BUILD_TARGET_TYPE}"
    pipeline.artifactsList = "**/*--Android1.apk, *_version"
    pipeline.ifUploadToGDrive = false
    println "Branch is " + pipeline.branchName

    pipeline.run()

}
